!function(e){var t={};function o(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,o),n.l=!0,n.exports}o.m=e,o.c=t,o.d=function(e,t,i){o.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},o.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=0)}([function(e,t){var o=function(e,t,o){var i=getComputedStyle(e.target),n=i.getPropertyValue("transform"),a=i.getPropertyValue("transform-origin").replace(/px/g,"").split(" ");a[0]=parseFloat(a[0]),a[1]=parseFloat(a[1]),a[2]=parseFloat(a[2]||0);var r=new THREE.Matrix4;if(r.identity(),/^matrix\(/.test(n)){var s=n.replace(/^matrix\(|\)$/g,"").split(" ");r.elements[0]=parseFloat(s[0]),r.elements[1]=parseFloat(s[1]),r.elements[4]=parseFloat(s[2]),r.elements[5]=parseFloat(s[3]),r.elements[12]=parseFloat(s[4]),r.elements[13]=parseFloat(s[5])}else if(/^matrix3d\(/i.test(n)){s=n.replace(/^matrix3d\(|\)$/gi,"").split(" ");for(var d=0;d<16;d++)r.elements[d]=parseFloat(s[d])}var l=new THREE.Matrix4;l.makeTranslation(a[0],a[1],a[2]),l.multiply(r),r.makeTranslation(-a[0],-a[1],-a[2]),l.multiply(r);var c=new THREE.Vector3(e.layerX,e.layerY,0);c.applyMatrix4(l);var u=parseFloat(i.getPropertyValue("width")),p=parseFloat(i.getPropertyValue("height")),E=new THREE.Vector3(c.x/u*2-1,-c.y/p*2+1,.5);E.unproject(t),E.sub(t.position),E.normalize(),console.log(o);var m=new THREE.Raycaster(t.position,E).intersectObject(o);if(m.length>0)return m},i=function(){var e=new THREE.Object3D,t=new THREE.Mesh(new THREE.BoxGeometry(1,1,.1,1,1,1),new THREE.MeshLambertMaterial({color:16777215}));t.position.z=-.5,e.add(t),(t=t.clone()).position.z=.5,e.add(t),(t=t.clone()).position.z=0,t.position.x=-.5,t.rotation.y=Math.PI/2,e.add(t),(t=t.clone()).position.x=.5,e.add(t),(t=t.clone()).position.x=0,t.position.y=-.5,t.rotation.y=0,t.rotation.x=Math.PI/2,e.add(t);var o=e.children.slice(),i=new THREE.Object3D;return i.position.y=.5,i.position.x=.5,(t=t.clone()).position.y=0,t.position.x=-.5,i.add(t),e.add(i),o.push(t),e.position.z=.5,e.rotation.x=Math.PI/2,e.open=!1,e.tick=function(){i.rotation.z+=.1*((e.open?-Math.PI/1.5:0)-i.rotation.z)},{box:e,walls:o}},n=function(){var e=new THREE.Mesh(new THREE.SphereGeometry(.5,8,8),new THREE.MeshNormalMaterial);return e.material.shading=THREE.FlatShading,e.position.z=.5,e},a=(i=function(){var e=new THREE.BoxGeometry(1,1,1),t=new THREE.MeshNormalMaterial,o=new THREE.Mesh(e,t);return o.position.z=.5,o.position.x=1.5,o},function(e,t,o,i,n,a){radius=50;var r=new THREE.Object3D,s=new THREE.Shape;s.moveTo(t,o+radius),s.lineTo(t,o+a-radius),s.quadraticCurveTo(t,o+a,t+radius,o+a),s.lineTo(t+n-radius,o+a),s.quadraticCurveTo(t+n,o+a,t+n,o+a-radius),s.lineTo(t+n,o+radius),s.quadraticCurveTo(t+n,o,t+n-radius,o),s.lineTo(t+radius,o),s.quadraticCurveTo(t,o,t,o+radius);var d=new THREE.ShapeGeometry(s),l=new THREE.MeshBasicMaterial({color:3381759}),c=new THREE.Mesh(d,l);return c.rotation.set(Math.PI/2,-Math.PI/2e3,Math.PI),c.position.z=i,c.position.x=-t,c.position.y=0,(new THREE.FontLoader).load("Data/helvetiker_regular.typeface.json",function(o){var n=new THREE.TextGeometry(e,{font:o,size:80,height:5,curveSegments:12,bevelEnabled:!0,bevelThickness:10,bevelSize:8,bevelSegments:5}),a=new THREE.MeshPhongMaterial({color:16711680}),s=new THREE.Mesh(n,a);s.rotation.set(-Math.PI/2,-Math.PI/2e3,Math.PI),s.position.z=i-200,s.position.x=t>=0?-t-100:500-t,r.add(s)}),r.add(c),r.scale.set(.0019,.0019,.0019),r});function r(e,t,r){t.setPatternDetectionMode(artoolkit.AR_MATRIX_CODE_DETECTION),document.body.className=t.orientation;var s,d=new THREE.WebGLRenderer({antialias:!0});if("portrait"===t.orientation){var l=window.innerWidth/t.videoHeight*t.videoWidth,c=window.innerWidth;d.setSize(l,c),d.domElement.style.paddingBottom=l-c+"px"}else/Android|mobile|iPad|iPhone/i.test(navigator.userAgent)?d.setSize(window.innerWidth,window.innerWidth/t.videoWidth*t.videoHeight):(d.setSize(t.videoWidth,t.videoHeight),document.body.className+=" desktop");document.body.insertBefore(d.domElement,document.body.firstChild),(s=new THREE.PointLight(16777215)).position.set(40,40,40),e.scene.add(s),(s=new THREE.PointLight(16746496)).position.set(-40,-20,-30),e.scene.add(s);var u=i(),p=n(),E=n(),m=a("I'm a sphere",1,1,1e3,750,300),h=(u=i(),a("I'm a box",-600,1,1e3,750,300));h.visible=!1,E.position.z=3,d.domElement.addEventListener("click",function(t){o(t,e.camera,p)&&(t.preventDefault(),f+=1,m.visible=!m.visible),o(t,e.camera,u)&&(h.visible=!h.visible)},!1);var v=t.createThreeBarcodeMarker(5);v.add(p),v.add(u),v.add(m),v.add(h),e.scene.add(v);var T=0,f=0,w=function(){e.process(),T+=.05*(f-p.rotation.z),p.rotation.z+=T,T*=.8,e.renderOn(d),requestAnimationFrame(w)};w()}window.ARThreeOnLoad=function(){navigator.mediaDevices.enumerateDevices().then(function(e){var t=e.find(function(e){return-1!==e.label.indexOf("back")});!function(e){ARController.getUserMediaThreeScene({maxARVideoSize:640,cameraParam:"Data/camera_para.dat",deviceId:e.deviceId,onSuccess:r})}({deviceId:t?{exact:t.deviceId}:void 0})}).catch(function(e){alert(e.name+": "+e.message)})},window.ARController&&ARController.getUserMediaThreeScene&&ARThreeOnLoad()}]);